<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmi≈Üas Secƒ´ba - Sound & Glass Edition</title>
    <style>
        :root {
            --bg-overlay: rgba(0, 0, 0, 0.4);
            --card-back: rgba(44, 62, 80, 0.8);
            --card-front: rgba(255, 255, 255, 0.9);
            --p1-color: #3498db;
            --p2-color: #e67e22;
            --accent: #2ecc71;
            --text-light: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-image: linear-gradient(var(--bg-overlay), var(--bg-overlay)), url('background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-light);
            overflow: hidden;
        }

        #victoryCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99;
        }

        /* Ska≈Üas kontroles poga */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 110;
            transition: 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sound-toggle:hover { background: rgba(255,255,255,0.3); }
        .sound-off { opacity: 0.6; }

        .scoreboard {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            z-index: 10;
        }

        .player-box {
            padding: 15px 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.5s ease;
            min-width: 120px;
        }

        .player-box.active.p1 { border-color: var(--p1-color); box-shadow: 0 0 20px var(--p1-color); transform: scale(1.05); }
        .player-box.active.p2 { border-color: var(--p2-color); box-shadow: 0 0 20px var(--p2-color); transform: scale(1.05); }

        .winner-p1 { animation: glowP1 1.5s infinite alternate; border-width: 3px; z-index: 100; }
        .winner-p2 { animation: glowP2 1.5s infinite alternate; border-width: 3px; z-index: 100; }

        @keyframes glowP1 { from { box-shadow: 0 0 10px var(--p1-color); } to { box-shadow: 0 0 40px var(--p1-color); transform: scale(1.1); } }
        @keyframes glowP2 { from { box-shadow: 0 0 10px var(--p2-color); } to { box-shadow: 0 0 40px var(--p2-color); transform: scale(1.1); } }

        .player-name { font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .score-num { font-size: 1.5rem; font-weight: bold; }

        .game-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            perspective: 1000px;
            z-index: 10;
        }

        .card {
            width: 70px;
            height: 95px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card.flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card-back { background: var(--card-back); backdrop-filter: blur(5px); }
        .card-front {
            background: var(--card-front);
            color: #2c3e50;
            transform: rotateY(180deg);
            border: 2px solid var(--accent);
            font-weight: bold;
        }

        .status-area {
            margin-top: 25px;
            text-align: center;
            min-height: 100px;
            padding: 15px 30px;
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            backdrop-filter: blur(5px);
            z-index: 10;
        }

        .restart-btn {
            padding: 10px 25px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <canvas id="victoryCanvas"></canvas>

    <button class="sound-toggle" id="soundBtn" onclick="toggleSound()">
        <span id="soundIcon">üîä</span> Ska≈Üa: ON
    </button>

    <div class="scoreboard">
        <div id="p1Box" class="player-box p1">
            <div class="player-name" style="color: var(--p1-color)">1. SpƒìlƒìtƒÅjs</div>
            <div id="p1Score" class="score-num">0</div>
        </div>
        <div id="p2Box" class="player-box p2">
            <div class="player-name" style="color: var(--p2-color)">2. SpƒìlƒìtƒÅjs</div>
            <div id="p2Score" class="score-num">0</div>
        </div>
    </div>

    <div class="game-container" id="gameBoard"></div>

    <div class="status-area">
        <div class="status" id="statusMessage">Sagatavo≈°anƒÅs...</div>
        <button class="restart-btn" id="restartBtn" onclick="initGame()" style="display:none">Spƒìlƒìt vƒìlreiz</button>
        <button onclick="initGame()" style="background:none; border:none; color:white; cursor:pointer; opacity:0.5; font-size:0.7rem; margin-top:10px;">Atiestatƒ´t sistƒìmu</button>
    </div>

    <script>
        const gameBoard = document.getElementById('gameBoard');
        const statusMessage = document.getElementById('statusMessage');
        const restartBtn = document.getElementById('restartBtn');
        const canvas = document.getElementById('victoryCanvas');
        const ctx = canvas.getContext('2d');
        
        let nextNumber = 1, isProcessing = false, currentPlayer = 1;
        let p1Score = 0, p2Score = 0, particles = [], isSoundOn = true;

        // --- SKA≈ÖAS SISTƒíMA ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(f, t, d, v=0.1) {
            if (!isSoundOn) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = t;
            osc.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + d);
        }

        const sounds = {
            click: () => playTone(600, 'sine', 0.1, 0.05),
            flip: () => playTone(400, 'triangle', 0.1),
            success: () => { playTone(800, 'sine', 0.2); setTimeout(()=>playTone(1000, 'sine', 0.2), 50); },
            error: () => playTone(150, 'sawtooth', 0.3),
            win: () => { [523, 659, 783, 1046].forEach((f, i)=>setTimeout(()=>playTone(f, 'sine', 0.5), i*150)); }
        };

        function toggleSound() {
            isSoundOn = !isSoundOn;
            const btn = document.getElementById('soundBtn');
            const icon = document.getElementById('soundIcon');
            btn.classList.toggle('sound-off', !isSoundOn);
            icon.innerText = isSoundOn ? "üîä" : "üîá";
            btn.innerHTML = `<span id="soundIcon">${isSoundOn ? "üîä" : "üîá"}</span> Ska≈Üa: ${isSoundOn ? "ON" : "OFF"}`;
            if(isSoundOn) sounds.click();
        }

        // --- SPƒíLES LOƒ¢IKA ---
        function initGame() {
            sounds.click();
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            document.getElementById('p1Box').className = 'player-box p1 active';
            document.getElementById('p2Box').className = 'player-box p2';
            
            gameBoard.innerHTML = '';
            nextNumber = 1; isProcessing = false; currentPlayer = 1;
            p1Score = 0; p2Score = 0;
            
            updateUI();
            restartBtn.style.display = 'none';
            statusMessage.innerText = "Atrodi skaitli 1";

            const shuffled = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].sort(() => Math.random() - 0.5);
            shuffled.forEach(num => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front">${num}</div>`;
                card.onclick = () => handleCardClick(card, num);
                gameBoard.appendChild(card);
            });
        }

        function updateUI() {
            document.getElementById('p1Score').innerText = p1Score;
            document.getElementById('p2Score').innerText = p2Score;
            if (nextNumber <= 10) {
                document.getElementById('p1Box').classList.toggle('active', currentPlayer === 1);
                document.getElementById('p2Box').classList.toggle('active', currentPlayer === 2);
            }
        }

        function handleCardClick(card, value) {
            if (isProcessing || card.classList.contains('flipped')) return;
            card.classList.add('flipped');
            sounds.flip();

            if (value === nextNumber) {
                if (currentPlayer === 1) p1Score++; else p2Score++;
                updateUI();

                if (nextNumber === 10) {
                    sounds.win();
                    let winMsg = p1Score > p2Score ? "üèÜ 1. SPƒíLƒíTƒÄJS UZVAR!" : (p2Score > p1Score ? "üèÜ 2. SPƒíLƒíTƒÄJS UZVAR!" : "NEIZ≈†ƒ∂IRTS!");
                    if(p1Score > p2Score) document.getElementById('p1Box').classList.add('winner-p1');
                    if(p2Score > p1Score) document.getElementById('p2Box').classList.add('winner-p2');
                    
                    statusMessage.innerHTML = `<span style="color:var(--accent); font-weight:bold">${winMsg}</span>`;
                    restartBtn.style.display = 'inline-block';
                    createConfetti();
                    drawConfetti();
                } else {
                    nextNumber++;
                    sounds.success();
                    statusMessage.innerText = `Labi! Meklƒì ${nextNumber}`;
                }
            } else {
                isProcessing = true;
                if (currentPlayer === 1) p1Score--; else p2Score--;
                sounds.error();
                updateUI();
                statusMessage.innerText = `Kƒº≈´da! KƒÅrta pretiniekam.`;

                setTimeout(() => {
                    document.querySelectorAll('.card').forEach(c => c.classList.remove('flipped'));
                    nextNumber = 1;
                    currentPlayer = currentPlayer === 1 ? 2 : 1;
                    updateUI();
                    isProcessing = false;
                    statusMessage.innerText = `Meklƒì skaitli 1`;
                }, 1000);
            }
        }

        // Konfeti funkcijas paliek tƒÅs pa≈°as...
        function createConfetti() {
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    r: Math.random() * 6 + 2,
                    d: Math.random() * 10,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    tilt: Math.random() * 10 - 10
                });
            }
        }

        function drawConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.y += Math.cos(p.d) + 2 + p.r/2;
                p.x += Math.sin(p.d) * 2;
                ctx.beginPath(); ctx.lineWidth = p.r; ctx.strokeStyle = p.color;
                ctx.moveTo(p.x + p.tilt + p.r/2, p.y);
                ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r/2);
                ctx.stroke();
                if (p.y > canvas.height) particles[i] = { ...p, y: -20, x: Math.random() * canvas.width };
            });
            if (restartBtn.style.display === 'inline-block') requestAnimationFrame(drawConfetti);
        }

        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        initGame();
    </script>
</body>
</html>
